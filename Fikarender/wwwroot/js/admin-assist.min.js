
function getTags(n, t) {
    preloader(); $("#tag-modal #prdId").val(n);
    $.post("/admin/get-product-tags", { id: n },
        function (n) {
            var i = n.allTags, r = n.currentTags; console.log(i); console.log(r);
            $("#tag-modal h3").text("برچسب های محصول (" + t + ")");
            $("#currentTags ul").html("");
            $.each(r, function (n, t) {
                var i = '<li><span class="far fa-times-circle pointer" data-id="' + t.productTagId + '" onclick="removeTag(this)" ><\/span><span class="xs uk-margin-small-right">' + t.tagName + "<\/span><\/li>"; $("#currentTags ul").append(i)
            });
            $("#allTags").html("");
            $("#allTags").append('<option value="0">----<\/option>');
            $.each(i, function (n, t) {
                var i = '<option value="' + t.id + '">' + t.name + "<\/option>";
                $("#allTags").append(i)
            });
            UIkit.modal("#tag-modal").show()
        }, "json").then(function () { preloader() })
}
function removeTag(n) {
    preloader(); var t = $(n).data("id");
    $.post("/admin/remove-product-tag", { id: t },
        function (t) {
            t == !0 ? $(n).parent().fadeOut(500) : alert("خطای سرور در هنگام حذف تگ رخ داده است. لطفا چند دقیقه دیگر امتحان کنید.")
        }, "json").then(function () { preloader() })
}
function addTag(n) {
    var t = $(n).val(), i; t > 0 && (preloader(), i = $("#prdId").val(),
        $.post("/admin/add-product-tag", { tagId: t, productId: i }, function (t) {
            if (t > 0) {
                var i = $("option:selected", n).text();
                $("#currentTags ul").append('<li><span class="far fa-times-circle pointer" data-id="' + t + '" onclick="removeTag(this)" ><\/span><span class="xs uk-margin-small-right">' + i + "<\/span><\/li>");
                $("option:selected", n).remove()
            } else t == 0 && alert("خطای سرور در هنگام افزودن تگ رخ داده است. لطفا چند دقیقه دیگر امتحان کنید.")
        }, "json").then(function () { preloader() }))
}
function filterSwitch(filternames) {
    let filtername = $(filternames).val(), t = "";
    switch (filtername) {
        case "fullname":
            t = '<label class="uk-form-label">نام‌ونام خانوادگی را تایپ کنید<\/label><input type="text" name="fullname" class="uk-input uk-border-rounded" />';
            break;
        case "phone":
            t = '<label class="uk-form-label">شماره موبایل را تایپ کنید<\/label><input type="text" name="phone" max="11" class="uk-input uk-border-rounded" />';
            break;
        case "socialId":
            t = '<hr /><label class="uk-form-label">آیدی اینستاگرام را تایپ کنید<\/label><input type="text" name="socialId" max="11" dir="ltr" class="uk-input uk-border-rounded" />'
            /*t = '<div class="uk-grid-medium uk-child-width-1-1 uk-child-width-1-2@m" uk-grid><div><label>از<\/label><input class="uk-input uk-border-rounded" name="param1" type="number" min="0" max="100" /><\/div><div><label>تا<\/label><input class="uk-input uk-border-rounded" name="param2" type="number" min="0" max="100" /><\/div><\/div>';*/
            break;
        case "location": preloader();
            t = '<label class="uk-form-label">شهر مورد نظر خود را انتخاب کنید<\/label><input type="text" name="socialId" class="uk-input uk-border-rounded" />';
            $("#append-filter").html(t); preloader();
        /*$.post('@Url.Action("GetAllTags")', {}, function (filternames) {
            $.each(filternames, function (filternames, t) {
                $("#param-select").append('<option value="' + t.id + '">' + t.name + "<\/option>")
            })
        }, "json").then(function () { preloader() })*/
    }
    filtername != "tag" && $("#append-filter").html(t)
}
function filter() {
    let n = $("select[name=filterBy]").val();
    if (n != 0) {
        preloader();
        let n = $("#search-modal form").serialize();
        $.post("/admin/assist", n, function (n) {
            $("#append").html(n)
        }, "html").then(function () { UIkit.modal("#search-modal").hide(); preloader() })
    } else UIkit.notification({ message: "لطفا نحوه فیلتر را انتخاب و مقدار آن را پر کنید.", status: "danger", pos: "bottom-center", timeout: 6e3 }), $("select[name=filterBy]").focus()
}
function opration(n, t) {
    var i = $("#op-modal");
    i.find(".uk-modal-title").text(t);
    i.find("#gallery").attr("href", "/admin/product-gallery/" + n);
    i.find("#tags").attr("onclick", "getTags(" + n + ', "' + t + '")');
    i.find("#attr").attr("href", "/admin/product-attr/" + n);
    i.find("#variant").attr("href", "/admin/product-variant/" + n);
    UIkit.modal("#op-modal").show()
}
function showAssist(assistId) {
    /*event.stopPropagation();*/
    preloader();
    $.get('/admin/assist', { 'assistId': assistId },
        function (response) {
            $('#show-assist-modal').html(response);
        }, 'html').then(function () {
            setTimeout(function () {
                UIkit.modal('#show-assist-modal').show();
                $('#preloader').hide();
            }, 500);
        });
}
$("#search-modal form").on("submit", function (n) {
    n.preventDefault();
    filter()
});

/*function downloadCvFile() {
    $('#preloader').fadeIn(150);
    $('#download-form').submit();
    UIkit.modal('#show-assist-modal').hide();
    $('#preloader').fadeOut(100);
}*/
function downloadCvFile() {
    var assistId = $('#download-form input[name = "assistId"]').val();
    $('#preloader').fadeIn();
    $('#download-form').submit();
    $.post('/admin/download-cv-file', { 'assistId': assistId },
        function (response) {
            if (response === false) {
                UIkit.notification({ message: response.msg, status: response.status, pos: 'bottom-center', timeout: 5000 });
            } else {
                /*UIkit.notification({ message: response.msg, status: response.status, pos: 'bottom-center', timeout: 5000 });*/
            }
        }, 'json').then(function () {
            $('#preloader').fadeOut();
        });
}
